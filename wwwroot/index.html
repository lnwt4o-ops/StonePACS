<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>StonePACS Web Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4>üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à (Web Registration)</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label>HN</label>
                        <div class="input-group">
                            <input type="text" id="hn" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå HN ‡πÄ‡∏ä‡πà‡∏ô taotest">
                            <button class="btn btn-outline-primary" onclick="searchPatient()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                        <input type="text" id="firstName" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="lastName" class="form-control">
                    </div>
                    <div class="col-md-12">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</label>
                        <select id="examSelect" class="form-select" onchange="updateDescription()">
                            <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>
                        </select>
                    </div>
                    <div class="col-md-12">
                        <button class="btn btn-success w-100" onclick="saveOrder()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                    </div>
                </div>
                <div id="msg" class="mt-3 text-center fw-bold"></div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏≤‡∏Å Database ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        async function loadExamCodes() {
            const res = await fetch('/api/exam-codes');
            if (res.ok) {
                const codes = await res.json();
                const select = document.getElementById('examSelect');
                codes.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c.code;
                    opt.text = `[${c.modality}] ${c.code} - ${c.name}`;
                    opt.dataset.desc = c.description;
                    opt.dataset.modality = c.modality;
                    select.appendChild(opt);
                });
            }
        }

        async function searchPatient() {
            const hn = document.getElementById('hn').value;
            const res = await fetch(`/api/patient/${hn}`);
            if (res.ok) {
                const p = await res.json();
                document.getElementById('firstName').value = p.firstName;
                document.getElementById('lastName').value = p.lastName;
                document.getElementById('msg').innerText = "‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏Å‡πà‡∏≤";
            }
        }

        async function saveOrder() {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà API /api/register
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Worklist ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        }

        window.onload = loadExamCodes;
    </script>
</body>

</html>